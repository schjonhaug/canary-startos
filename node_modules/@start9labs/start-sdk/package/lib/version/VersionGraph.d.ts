import { ExtendedVersion, VersionRange } from "../../../base/lib/exver";
import * as T from "../../../base/lib/types";
import { InitKind, InitScript, InitScriptOrFn, UninitScript, UninitScriptOrFn } from "../../../base/lib/inits";
import { VersionInfo } from "./VersionInfo";
export declare function getDataVersion(effects: T.Effects): Promise<ExtendedVersion | VersionRange | null>;
export declare function setDataVersion(effects: T.Effects, version: ExtendedVersion | VersionRange | null): Promise<null>;
export declare function overlaps(a: ExtendedVersion | VersionRange, b: ExtendedVersion | VersionRange): boolean;
export declare class VersionGraph<CurrentVersion extends string> implements InitScript, UninitScript {
    readonly current: VersionInfo<CurrentVersion>;
    private readonly preInstall?;
    private readonly uninstall?;
    protected initFn: (effects: T.Effects, kind: InitKind) => Promise<void>;
    protected uninitFn: (effects: T.Effects, target: VersionRange | ExtendedVersion | null) => Promise<void>;
    private readonly graph;
    dump(): string;
    private constructor();
    currentVersion: () => ExtendedVersion;
    /**
     * Each exported `VersionInfo.of()` should be imported and provided as an argument to this function.
     *
     * ** The current version must be the FIRST argument. **
     */
    static of<CurrentVersion extends string, OtherVersions extends Array<VersionInfo<any>>>(options: {
        current: VersionInfo<CurrentVersion>;
        other: OtherVersions;
        /**
         * A script to run only on fresh install
         */
        preInstall?: InitScriptOrFn<"install">;
        /**
         * A script to run only on uninstall
         */
        uninstall?: UninitScriptOrFn;
    }): VersionGraph<CurrentVersion>;
    migrate({ effects, from, to, }: {
        effects: T.Effects;
        from: ExtendedVersion | VersionRange;
        to: ExtendedVersion | VersionRange;
    }): Promise<ExtendedVersion | VersionRange>;
    canMigrateFrom: () => VersionRange;
    canMigrateTo: () => VersionRange;
    init(effects: T.Effects, kind: InitKind): Promise<void>;
    uninit(effects: T.Effects, target: VersionRange | ExtendedVersion | null): Promise<void>;
}
export type EnsureUniqueId<A, B = A, OtherVersions = never> = B extends [] ? A : B extends [VersionInfo<infer Version>, ...infer Rest] ? (Version extends OtherVersions ? "One or more versions are not unique"[] : EnsureUniqueId<A, Rest, Version | OtherVersions>) : "There exists a migration that is not a Migration"[];
